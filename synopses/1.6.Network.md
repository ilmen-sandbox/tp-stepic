# Что происходит при HTTP запросе?

1. Браузер парсит URL (примем его за абсолютный для простоты), извлекаем имя хоста (домен), протокол (http, https)
2. Используя DNS преобразуем имя хоста (домен) в IP-адрес web-сервера
3. Устанавливаем TCP соединение с web-сервером
  1. Если используется HTTPs - устанавливаем TLS соединение (шифрованное и защищенное) поверх TCP
4. Формируем HTTP-запрос, отправляем его web-серверу, получаем документ-ответ
5. Пусть браузер закрывает соединение **(это для HTTP/1.0)**
6. Браузер загружает связанные ресурсы
  
## Стек сетевых протоколов
*Указаны не все уровни стека*
![stack](https://github.com/ilmen/tp-stepic/blob/master/lesson-5/pictures/stack.png "стек сетевых протоколов")

* HTTPs+TLS: реализовано в userspace (браузер/web-сервер)
* TCP+IP: реализовано в ОС клиента/сервера

Запрос от браузера проходит по всем уровням стека на клиенской машине, передаются на сервер, на стороне сервера сообщение "поднимаются" по стеку вверх.

Т.е. передача по HTTP(s) - это передача сообщения на самом нижнем уровне, по с включением в стек уровней TLS и HTTP(s) (TLS использутся только при использовании HTTPs).

## DNS
**DNS** (Domain Name System) - это *распределенная база данных*, хранящая информацию о доменах, в первую очередь отображение доменных имен на IP адреса машин, обслуживающих эти домены.

### Пространство доменных имен
**Пространство доменных имен** - строки, состоящие из слов, разделенных точками. Домены образуют древовидную структуру.

Например, сайт *wikipedia* имеет домен: ru.wikipedia.org.  
0. Домен нулевого уровня: .  
*Обычно не указывается в URL*  
1. Домены первого уровня: ru, en, org, edu, ...  
*Практически статичное множество (например* ***ru*** *- Россия,* ***org*** *- организации,* ***edu*** *- образование)*  
2. Домены второго уровня: yandex, stepic, mail, wikipedia, ...  
*Примерно соответствуют организациям*  
3. Домены третьего уровня и т.д.

### Зоны
База DNS поделена на зоны. Каждая зона находиться под единым *административным* контролем (обслуживается *одной организацией*).  
В одну зону могут входить и домены одного уровня, так и некоторая иерархия доменов.  
Управление более высокоуровневыми или низкоуровневыми зонами может быть делегировано другим организациям.

![dns-zones](https://github.com/ilmen/tp-stepic/blob/master/lesson-5/pictures/zones.png "Зоны DNS")  

### DNS запрос
DNS запросы производятся по специальному протоколу.  
На любом компьютере всегда **должен** быть прописан адрес DNS сервера (обычно, DNS-сервер организации или DNS-сервер провайдера).  
* Может быть задан вручную в настройках сетевого соединения
* Может быть получен по протоколу DHCP от роутера или провайдера
* Существует заранее известный список **корневых** DNS-серверов (те самые *ru*, *org* и т.п., их IP меняется очень редко и может быть закешировано на долго в недрах ОС)

Вот как происходит обработка запроса:
![dns-request](https://github.com/ilmen/tp-stepic/blob/master/lesson-5/pictures/dnsreq.png "DNS запрос")  
Для **снижения нагрузки** на DNS-сервера (*особенно нагрузки на корневые DNS-сервера*) используется механизм **кеширования** ответов DNS-серверов на DNS-сервере провайдера, чтобы при последующих запросах не делегировать запросы к сторонним DNS-серверам, а сразу возвращать закешированные ответы.  
Также в ОС есть файл **hosts**, который предоставляет возможность задать жесткую связь домена и IP адреса. Файл hosts проверяется до обращения к локальному DNS-серверу.
 
 <span style="color:blue;">Внимание:</span> для электронной почты используется другие DNS-сервера.

